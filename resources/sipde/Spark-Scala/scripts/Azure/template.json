{
    "$schema": "http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",
    "contentVersion": "0.9.0.0",
    "parameters": {
        "clusterName": {
            "type": "string",
            "metadata": {
                "description": "The name of the HDInsight cluster to create."
            }
        },
        "sizeConfig": {
            "type": "string",
            "defaultValue": "2WorkersConfig",
            "allowedValues": [
      				"1WorkerConfig",
      				"2WorkersConfig",
        			"4WorkersConfig",
				"6WorkersConfig"
	      		],
            "metadata": {
                "description": "The size configuration of the cluster."
            }
        }
    },
    "variables": {
    	"1WorkerConfig":{
    		"masterCount": 2,
    		"workerCount": 1,
    		"vmSize": "Standard_A3",
    		"workerInstances": 4
    	},
    	"2WorkersConfig":{
    		"masterCount": 2,
    		"workerCount": 2,
    		"vmSize": "Standard_A3",
    		"workerInstances": 8
    	},
    	"4WorkersConfig":{
    		"masterCount": 2,
    		"workerCount": 4,
    		"vmSize": "Standard_A3",
    		"workerInstances": 16
    	},
		  "6WorkersConfig":{
                "masterCount": 2,
                "workerCount": 6,
                "vmSize": "Standard_A3",
    		"workerInstances": 24
       },
    	"masterCount": "[variables(parameters('sizeConfig')).masterCount]",
    	"workerCount": "[variables(parameters('sizeConfig')).workerCount]",
    	"vmSize": "[variables(parameters('sizeConfig')).vmSize]",
    	"workerInstances": "[variables(parameters('sizeConfig')).workerInstances]"
    	
    },
    "resources": [
        {
            "apiVersion": "2015-03-01-preview",
            "name": "[parameters('clusterName')]",
            "type": "Microsoft.HDInsight/clusters",
            "location": "northeurope",
            "dependsOn": [],
            "properties": {
                "clusterVersion": "3.4",
                "osType": "Linux",
                "tier": "standard",
                "clusterDefinition": {
                    "kind": "spark",
                    "configurations": {
                        "gateway": {
                            "restAuthCredential.isEnabled": true,
                            "restAuthCredential.username": "user",
                            "restAuthCredential.password": "Password"
                        },
                        "core-site": {
                            "fs.defaultFS": "wasb://yourcluster@yourstorage.blob.core.windows.net",
                            "fs.azure.account.key.eclibstorage.blob.core.windows.net": "your Azure Storage key"
                        },
                        "spark-defaults": {
                        		"spark.driver.extraLibraryPath": "/opt/SB",
                        		"spark.executor.extraLibraryPath": "/opt/SB",
	                      		"spark.executor.cores": "1",
	                      		"spark.executor.instances": "workerInstances"
                        }
                    }
                },
                "computeProfile": {
                    "roles": [
                        {
                            "name": "headnode",
                            "minInstanceCount": 1,
                            "targetInstanceCount": "[variables('masterCount')]",
                            "hardwareProfile": {
                                "vmSize": "[variables('vmSize')]"
                            },
                            "osProfile": {
                                "linuxOperatingSystemProfile": {
                                    "username": "user",
                                    "password": "Password"
                                }
                            },
                            "virtualNetworkProfile": {
                                "id": "yournetworkid",
                                "subnet": "yoursubnet"
                            },
                            "scriptActions": [
                                {
                                    "name": "loadData",
                                    "uri": "Azure Storage URL of the cluster configuration script",
                                    "parameters": "",
                                    "isHeadNode": true,
                                    "isWorkerNode": true
                                }
                            ]
                        },
                        {
                            "name": "workernode",
                            "minInstanceCount": 1,
                            "targetInstanceCount": "[variables('workerCount')]",
                            "hardwareProfile": {
                                "vmSize": "[variables('vmSize')]"
                            },
                            "osProfile": {
                                "linuxOperatingSystemProfile": {
                                    "username": "user",
                                    "password": "Password"
                                }
                            },
                            "virtualNetworkProfile": {
	                             "id": "yournetworkid",
	                             "subnet": "yoursubnet"
                               },
                            "scriptActions": [
                                {
                                    "name": "loadData",
                                    "uri": "Azure Storage URL of the cluster configuration script",
                                    "parameters": "",
                                    "isHeadNode": true,
                                    "isWorkerNode": true
                                }
                            ]
                        }
                    ]
                }
            }
        }
    ]
}
